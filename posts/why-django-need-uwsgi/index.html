<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>ä¸ºä»€ä¹ˆ Django éœ€è¦uWSGI - Shawn's blog</title><meta name=Description content="åˆ†äº«æˆ‘çš„çŸ¥è¯†ã€ç»éªŒã€ç”Ÿæ´»ä¸æ„Ÿæ‚Ÿ"><meta property="og:url" content="https://blog.programmer.work/posts/why-django-need-uwsgi/"><meta property="og:site_name" content="Shawn's blog"><meta property="og:title" content="ä¸ºä»€ä¹ˆ Django éœ€è¦uWSGI"><meta property="og:description" content="0X00 è¿è¡Œä¸€ä¸ª Django ç¨‹åº è¿è¡Œä¸€ä¸ª Django ç¨‹åºå¯å¤ªç®€å•äº†ï¼Œä»åˆ›å»ºé¡¹ç›®åˆ°è¿è¡Œèµ·æ¥æ€»å…±ä¹Ÿä¸è¶…è¿‡ 5 è¡Œä»£ç ã€‚é¡¹ç›®è¿è¡Œèµ·æ¥äº†å°±å¯ä»¥æ‰“å¼€æˆ‘ä»¬çš„ vim æˆ–è€… IDE ä¹‹ç±»çš„ä¸€é¡¿ coding äº†ã€‚ä½œä¸ºæœ€æœ€æœ€å¼€å§‹å†™ Django çš„åŒå­¦æ¥è¯´åˆ°è¿™é‡Œä¹Ÿå°±äº†è§£çš„å·®ä¸å¤šäº†ï¼Œå› ä¸ºå¤§å®¶éƒ½æ˜¯è‡ªå·±å†™å¥½ä»£ç æœ¬åœ°æµ‹è¯•ä¸€ä¸‹å°±æ Pul Request åˆ°ä¸Šæ¸¸ä»“åº“äº†ï¼Œç„¶åä»€ä¹ˆå•å…ƒæµ‹è¯•ã€æ•°æ®åº“è¿ç§»ã€æµ‹è¯•ç¯å¢ƒç‰ˆæœ¬å‘å¸ƒç”šè‡³å¯èƒ½åŒ…å« docker é•œåƒæ›´æ–°å°±å…¨éƒ½äº¤ç»™ CI æ¥åšäº†ã€‚è‡ªå·±å°±è¿™ä¹ˆå¼€å¼€å¿ƒå¿ƒçš„å†™äº†ä¸€æ®µæ—¶é—´çš„ä»£ç ï¼Œä¸€åˆ‡éƒ½åœ¨æœç€å¥½çš„æ–¹å‘å‘å±•ã€‚çªç„¶æœ‰ä¸€å¤©éƒ¨é—¨ä¸»ç®¡æˆ–è€…è€å¤§å‘Šè¯‰ä½ æœ‰ä¸€ä¸ªæ–°é¡¹ç›®è¦ä½ æ¥å¼€ä¸ªå¤´ï¼Œå…ˆæ­å¥½è„šæ‰‹æ¶ç„¶åå‘å¸ƒä¸Šå»ï¼Œåé¢å†æ¥äººä¸€èµ·åšåŠŸèƒ½è¿­ä»£ã€‚"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-06-30T13:35:00+00:00"><meta property="article:modified_time" content="2025-01-17T02:15:26+00:00"><meta property="article:tag" content="Django"><meta property="article:tag" content="UWSGI"><meta property="og:image" content="https://blog.programmer.work/logo.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.programmer.work/logo.png"><meta name=twitter:title content="ä¸ºä»€ä¹ˆ Django éœ€è¦uWSGI"><meta name=twitter:description content="0X00 è¿è¡Œä¸€ä¸ª Django ç¨‹åº è¿è¡Œä¸€ä¸ª Django ç¨‹åºå¯å¤ªç®€å•äº†ï¼Œä»åˆ›å»ºé¡¹ç›®åˆ°è¿è¡Œèµ·æ¥æ€»å…±ä¹Ÿä¸è¶…è¿‡ 5 è¡Œä»£ç ã€‚é¡¹ç›®è¿è¡Œèµ·æ¥äº†å°±å¯ä»¥æ‰“å¼€æˆ‘ä»¬çš„ vim æˆ–è€… IDE ä¹‹ç±»çš„ä¸€é¡¿ coding äº†ã€‚ä½œä¸ºæœ€æœ€æœ€å¼€å§‹å†™ Django çš„åŒå­¦æ¥è¯´åˆ°è¿™é‡Œä¹Ÿå°±äº†è§£çš„å·®ä¸å¤šäº†ï¼Œå› ä¸ºå¤§å®¶éƒ½æ˜¯è‡ªå·±å†™å¥½ä»£ç æœ¬åœ°æµ‹è¯•ä¸€ä¸‹å°±æ Pul Request åˆ°ä¸Šæ¸¸ä»“åº“äº†ï¼Œç„¶åä»€ä¹ˆå•å…ƒæµ‹è¯•ã€æ•°æ®åº“è¿ç§»ã€æµ‹è¯•ç¯å¢ƒç‰ˆæœ¬å‘å¸ƒç”šè‡³å¯èƒ½åŒ…å« docker é•œåƒæ›´æ–°å°±å…¨éƒ½äº¤ç»™ CI æ¥åšäº†ã€‚è‡ªå·±å°±è¿™ä¹ˆå¼€å¼€å¿ƒå¿ƒçš„å†™äº†ä¸€æ®µæ—¶é—´çš„ä»£ç ï¼Œä¸€åˆ‡éƒ½åœ¨æœç€å¥½çš„æ–¹å‘å‘å±•ã€‚çªç„¶æœ‰ä¸€å¤©éƒ¨é—¨ä¸»ç®¡æˆ–è€…è€å¤§å‘Šè¯‰ä½ æœ‰ä¸€ä¸ªæ–°é¡¹ç›®è¦ä½ æ¥å¼€ä¸ªå¤´ï¼Œå…ˆæ­å¥½è„šæ‰‹æ¶ç„¶åå‘å¸ƒä¸Šå»ï¼Œåé¢å†æ¥äººä¸€èµ·åšåŠŸèƒ½è¿­ä»£ã€‚"><meta name=application-name content="Shawn's blog"><meta name=apple-mobile-web-app-title content="Shawn's blog"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=/favicon.svg><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://blog.programmer.work/posts/why-django-need-uwsgi/><link rel=prev href=https://blog.programmer.work/posts/django-export-csv/><link rel=next href=https://blog.programmer.work/posts/sso-yu-cas/><link rel=stylesheet href=/css/style.min.658eb25b73ad29ab864a36ed014516c5047802d1ff98d0080132d1abe1332f5b.css integrity="sha256-ZY6yW3OtKauGSjbtAUUWxQR4AtH/mNAIATLRq+EzL1s="><link rel=preload href=/lib/fontawesome-free/all.min.0df5a33710e433de1f5415b1d47e4130ca7466aee5b81955f1045c4844bbb3ed.css integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.0df5a33710e433de1f5415b1d47e4130ca7466aee5b81955f1045c4844bbb3ed.css integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0="></noscript><link rel=preload href=/lib/animate/animate.min.5fbaeb9f8e25d7e0143bae61d4b1802c16ce7390b96ceb2d498b0d96ff4c853f.css integrity="sha256-X7rrn44l1+AUO65h1LGALBbOc5C5bOstSYsNlv9MhT8=" as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.5fbaeb9f8e25d7e0143bae61d4b1802c16ce7390b96ceb2d498b0d96ff4c853f.css integrity="sha256-X7rrn44l1+AUO65h1LGALBbOc5C5bOstSYsNlv9MhT8="></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"ä¸ºä»€ä¹ˆ Django éœ€è¦uWSGI","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.programmer.work\/posts\/why-django-need-uwsgi\/"},"genre":"posts","keywords":"Django, uWSGI","wordcount":2328,"url":"https:\/\/blog.programmer.work\/posts\/why-django-need-uwsgi\/","datePublished":"2020-06-30T13:35:00+00:00","dateModified":"2025-01-17T02:15:26+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Shawn"},"description":""}</script></head><body data-header-desktop=auto data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"dark"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Shawn's blog">Shawn's blog</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>æ–‡ç«  </a><a class=menu-item href=/tags/>æ ‡ç­¾ </a><a class=menu-item href=/about/>å…³äº </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title=åˆ‡æ¢ä¸»é¢˜>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Shawn's blog">Shawn's blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>æ–‡ç« </a><a class=menu-item href=/tags/ title>æ ‡ç­¾</a><a class=menu-item href=/about/ title>å…³äº</a><a href=javascript:void(0); class="menu-item theme-switch" title=åˆ‡æ¢ä¸»é¢˜>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>ç›®å½•</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">ä¸ºä»€ä¹ˆ Django éœ€è¦uWSGI</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://blog.programmer.work title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Shawn</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2020-06-30>2020-06-30</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;çº¦ 2328 å­—&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;é¢„è®¡é˜…è¯» 5 åˆ†é’Ÿ&nbsp;</div></div><div class="details toc" id=toc-static data-kept=true><div class="details-summary toc-title"><span>ç›®å½•</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents></nav></div></div><div class=content id=content><h1 id=0x00-è¿è¡Œä¸€ä¸ª-django-ç¨‹åº>0X00 è¿è¡Œä¸€ä¸ª Django ç¨‹åº</h1><p>è¿è¡Œä¸€ä¸ª Django ç¨‹åºå¯å¤ªç®€å•äº†ï¼Œä»åˆ›å»ºé¡¹ç›®åˆ°è¿è¡Œèµ·æ¥æ€»å…±ä¹Ÿä¸è¶…è¿‡ 5 è¡Œä»£ç ã€‚é¡¹ç›®è¿è¡Œèµ·æ¥äº†å°±å¯ä»¥æ‰“å¼€æˆ‘ä»¬çš„ vim æˆ–è€… IDE ä¹‹ç±»çš„ä¸€é¡¿ coding äº†ã€‚ä½œä¸ºæœ€æœ€æœ€å¼€å§‹å†™ Django çš„åŒå­¦æ¥è¯´åˆ°è¿™é‡Œä¹Ÿå°±äº†è§£çš„å·®ä¸å¤šäº†ï¼Œå› ä¸ºå¤§å®¶éƒ½æ˜¯è‡ªå·±å†™å¥½ä»£ç æœ¬åœ°æµ‹è¯•ä¸€ä¸‹å°±æ Pul Request åˆ°ä¸Šæ¸¸ä»“åº“äº†ï¼Œç„¶åä»€ä¹ˆå•å…ƒæµ‹è¯•ã€æ•°æ®åº“è¿ç§»ã€æµ‹è¯•ç¯å¢ƒç‰ˆæœ¬å‘å¸ƒç”šè‡³å¯èƒ½åŒ…å« docker é•œåƒæ›´æ–°å°±å…¨éƒ½äº¤ç»™ CI æ¥åšäº†ã€‚è‡ªå·±å°±è¿™ä¹ˆå¼€å¼€å¿ƒå¿ƒçš„å†™äº†ä¸€æ®µæ—¶é—´çš„ä»£ç ï¼Œä¸€åˆ‡éƒ½åœ¨æœç€å¥½çš„æ–¹å‘å‘å±•ã€‚çªç„¶æœ‰ä¸€å¤©éƒ¨é—¨ä¸»ç®¡æˆ–è€…è€å¤§å‘Šè¯‰ä½ æœ‰ä¸€ä¸ªæ–°é¡¹ç›®è¦ä½ æ¥å¼€ä¸ªå¤´ï¼Œå…ˆæ­å¥½è„šæ‰‹æ¶ç„¶åå‘å¸ƒä¸Šå»ï¼Œåé¢å†æ¥äººä¸€èµ·åšåŠŸèƒ½è¿­ä»£ã€‚</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://blog-1251664340.cos.ap-chengdu.myqcloud.com/20200630214416.png data-srcset="https://blog-1251664340.cos.ap-chengdu.myqcloud.com/20200630214416.png, https://blog-1251664340.cos.ap-chengdu.myqcloud.com/20200630214416.png 1.5x, https://blog-1251664340.cos.ap-chengdu.myqcloud.com/20200630214416.png 2x" data-sizes=auto alt=https://blog-1251664340.cos.ap-chengdu.myqcloud.com/20200630214416.png title="è¿è¡Œä¸€ä¸ª Django ç¨‹åº"></p><p>ç„¶åä½ å¼€å¼€å¿ƒå¿ƒåœ°<code>django-admin startproject xxxx</code>ã€å¼€å¼€å¿ƒå¿ƒåœ°<code>django-admin startapp xxxxx</code>ï¼Œä¸€é¡¿ coding ä¹‹åæ‡µé€¼äº†ï¼Œæ²¡æœ‰éƒ¨ç½²è¿‡æµ‹è¯•ç¯å¢ƒï¼Œæ²¡æœ‰éƒ¨ç½²è¿‡ç”Ÿäº§ç¯å¢ƒï¼ŒåªçŸ¥é“ CI ç»™åšäº†ï¼Œå´å®Œå…¨ä¸çŸ¥é“åšäº†ä»€ä¹ˆã€‚ç„¶åä½ è·‘å»çœ‹ CI è„šæœ¬ï¼Œå»é—®å…¶ä»–åŒäº‹åŒå­¦ï¼Œå¾—åˆ°äº†ä¸€å † Nginx å’Œ uWSGI ä¹‹ç±»çš„ç­”å¤ã€‚ä½ ä¹Ÿç…§ç€åšäº†ï¼Œä½†æ˜¯å®Œå…¨ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œå› ä¸ºä½ è§‰å¾—<code>python manage.py runserver</code>æ˜æ˜å°±å¯ä»¥å¯åŠ¨é¡¹ç›®äº†ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦æä»€ä¹ˆ Nginx å’Œ uWSGI å‘¢ï¼Ÿ</p><h1 id=0x01-éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ>0X01 éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ</h1><p>æŒ‰æˆ‘ç°åœ¨æ‰‹ä¸Šçš„é¡¹ç›®æ¥è¯´ï¼Œéƒ¨ç½²é˜¶æ®µç”¨åˆ°äº†ï¼šdockerã€uWSGIã€supervisorã€Nginxã€fabricã€gitlab-ci è¿™ 5 ç§æŠ€æœ¯ã€‚å…¶ä¸­ docker æ˜¯ä¸ºäº†æ–¹ä¾¿å¤§å®¶çš„ç”Ÿäº§ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒå’Œå¼€å‘ç¯å¢ƒé«˜åº¦ä¸€è‡´çš„ï¼›uWSGI å’Œ Nginx åé¢å•ç‹¬è¯´ï¼›supervisor æ˜¯ç”¨æ¥ä¿æ´»çš„ï¼Œæœ‰æ—¶å€™è¿›ç¨‹æŒ‚äº†éœ€è¦æœ‰äººæ¥é‡å¯å®ƒï¼›fabric æ˜¯ç”¨æ¥å°†å¸¸ç”¨çš„å‘½ä»¤ç»„æ•´åˆçš„ï¼›gitlab-ci æ˜¯ç”¨æ¥æ–¹ä¾¿è¿è¡Œå•å…ƒæµ‹è¯•ã€æµ‹è¯•ç¯å¢ƒå‘å¸ƒå’Œç”Ÿäº§ç¯å¢ƒå‘å¸ƒçš„ã€‚</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://blog-1251664340.cos.ap-chengdu.myqcloud.com/20200630221308.png data-srcset="https://blog-1251664340.cos.ap-chengdu.myqcloud.com/20200630221308.png, https://blog-1251664340.cos.ap-chengdu.myqcloud.com/20200630221308.png 1.5x, https://blog-1251664340.cos.ap-chengdu.myqcloud.com/20200630221308.png 2x" data-sizes=auto alt=https://blog-1251664340.cos.ap-chengdu.myqcloud.com/20200630221308.png title="ç®€å•éƒ¨ç½² Django ç¨‹åº"></p><p>ä¸‹é¢å°±é‡ç‚¹æ¥è§£ç­”ä¸€ä¸‹è¿™ä¸ªæ–°æ‰‹ç¾¤ä½“ä¸­å¾ˆå®¹æ˜“å‡ºç°çš„ç–‘é—®ï¼š</p><blockquote><p>ä¸ºä»€ä¹ˆæ˜æ˜<code>python manage.py runserver</code>å°±èƒ½è¿è¡Œçš„ Django é¡¹ç›®éè¦ç”¨ Nginx å’Œ uWSGI è¿è¡Œå‘¢ï¼Ÿ</p></blockquote><h1 id=0x02-ä¸ºä»€ä¹ˆéœ€è¦-uwsgi>0X02 ä¸ºä»€ä¹ˆéœ€è¦ uWSGI</h1><p>å…·ä½“ä¸ºä»€ä¹ˆè¦ç”¨ uWSGI å…¶å®å¶é‡å¥½å¤šä¸ªåŸå› ï¼Œä¸‹é¢ä¼šé€ä¸ªæåˆ°ã€‚</p><p>é¦–å…ˆæœ€å¸¸è§çš„ä¸€ç§è¯´æ³•æ˜¯ï¼šâ€œ<code>python manage.py runserver</code>æ˜¯å•çº¿ç¨‹çš„ï¼Œä¸€ä¸ªè¯·æ±‚ä¸ç»“æŸå…¶ä»–çš„è¯·æ±‚å°±å¾—é˜»å¡ï¼Œæ‰€ä»¥æ€§èƒ½å·®â€ï¼Œè¿™ç§è¯´æ³•å½»å¤´å½»å°¾æ˜¯é”™è¯¯çš„ã€‚è€Œä¸”éªŒè¯èµ·æ¥ä¹ŸåŠå…¶å®¹æ˜“ï¼Œéšä¾¿æ‰¾ä¸€ä¸ªä½ çš„ Django é¡¹ç›®ç„¶åæ‰¾ä¸ª api ç”¨ ipdb æ‰“ä¸ªæ–­ç‚¹ï¼Œé€šè¿‡ runserver æŠŠå®ƒè·‘èµ·æ¥ã€‚ç„¶åå…ˆè°ƒç”¨æ‰“äº†æ–­ç‚¹çš„ apiï¼Œå‘ç°å®ƒå¡åœ¨æ–­ç‚¹å¤„äº†ï¼Œç„¶åå†è°ƒå¦ä¸€ä¸ª apiï¼Œå®é™…ä¸Šæ˜¯å¯ä»¥å¾—åˆ° response çš„ï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯æ‰€è°“å•çº¿ç¨‹å¯¼è‡´çš„ã€‚ä¸å…¶è¯´æ˜¯å› ä¸ºå•çº¿ç¨‹å¯¼è‡´æ€§èƒ½ä½ä¸‹å€’ä¸å¦‚è¯´æ˜¯å› ä¸ºâ€œå•è¿›ç¨‹â€ï¼Œä¼—æ‰€å‘¨çŸ¥ Python ä¸­æœ‰ä¸€ä¸ª GIL å…¨å±€è§£é‡Šé”ï¼Œè¿™ä¸œè¥¿çš„å­˜åœ¨å¯¼è‡´çœŸæ­£æ„ä¹‰ä¸Šçš„å•è¿›ç¨‹å¤šçº¿ç¨‹ Python ç¨‹åºå¹¶ä¸å¾—è¡Œï¼Œæ‰€ä»¥ uWSGI å¯ä»¥é€šè¿‡å¯åŠ¨å¤šä¸ªè¿›ç¨‹çš„æ–¹å¼æ¥è§„é¿è¿™ä¸ªé—®é¢˜ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­<code>processes = 8</code>çš„éƒ¨åˆ†ã€‚</p><pre tabindex=0><code class=language-conf data-lang=conf>    [uwsgi]
    chdir     = /code
    pp        = /code
    module    = ratel.wsgi
    master    = true
    processes = 8
    vacuum    = true
    http      = 0.0.0.0:7701
    stats = /tmp/xxxxx_stats.socket

    env = LANG=en_US.utf8
    env = DJANGO_SETTINGS_MODULE=xxxxx.settings

    harakiri  = 60
    http-timeout   = 60
    socket-timeout = 60

    max-requests = 8192
    listen       = 8192
    no-orphans
</code></pre><blockquote><p>è¿™é‡Œè¯´åˆ°å¤šè¿›ç¨‹ï¼Œæœ‰ä¸ªé¢˜å¤–è¯å¯ä»¥è¯´ä¸€ä¸‹ï¼šâ€œä½ è§‰å¾— Django ä¸­ä½¿ç”¨å…¨å±€å˜é‡æœ‰ä»€ä¹ˆéœ€è¦æ³¨æ„çš„å—ï¼Ÿâ€ã€‚é€šå¸¸æƒ…å†µæ¥è¯´ç¼–ç¨‹ä¸­ä½¿ç”¨å…¨å±€å˜é‡æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„é—®é¢˜ï¼Œä½†æ˜¯åœ¨å¤šè¿›ç¨‹çš„æƒ…å†µä¸‹å°±éœ€è¦å¤šå¤šæ³¨æ„äº†ã€‚æ¯”å¦‚æŒ‰ä¸Šé¢çš„é…ç½®ï¼Œä¸€ä¸ªé¡¹ç›®ç”¨äº† 8 ä¸ªè¿›ç¨‹ï¼Œå…¶ä¸­ä¸€ä¸ªè¿›ç¨‹æ¥åˆ°äº†ä¸€ä¸ª request å¹¶ä¸”æŠŠ<code>CURRENT_COUNT</code>ä» 80 æ”¹åˆ°äº† 100ï¼Œä½†æ˜¯å…¶ä»–è¿›ç¨‹åœ¨è®¿é—®è‡ªå·±è¿›ç¨‹é‡Œçš„<code>CURRENT_COUNT</code>çš„æ—¶å€™è¿˜æ˜¯ 80ï¼Œè¿™å°±æ˜¯å› ä¸ºå¤šä¸ªè¿›ç¨‹ä¸­å…¨å±€å˜é‡ä¸å¤Ÿâ€œå…¨å±€â€å¯¼è‡´çš„é—®é¢˜ã€‚é‚£ä¹ˆæ€ä¹ˆè§£å‘¢ï¼Ÿå…¶å®ä¹Ÿç®€å•ã€‚æˆ‘ä»¬è¿˜æ˜¯ç”¨<code>CURRENT_COUNT</code>ï¼Œä½†æ˜¯ä¸ç”¨å®ƒåšå˜é‡åäº†ï¼Œè€Œæ˜¯ MySQL çš„é…ç½®è¡¨ä¸­çš„ä¸€æ¡æ•°æ®ï¼Œæˆ–è€… Redis ä¸­çš„ key å°±èƒ½è§£å†³è¿™ä¸ªé—®é¢˜äº†ã€‚</p></blockquote><p>æ€§èƒ½é—®é¢˜å½“ç„¶æ˜¯ä¸ªå¤§é—®é¢˜ï¼Œä¸ç”¨ runserver è€Œæ˜¯æ”¹ç”¨ uWSGI çš„ä¸€å¤§åŸå› å°±æ˜¯æ€§èƒ½é—®é¢˜ï¼Œæˆ‘ä»¬ç”¨ <code>ab</code> æ¥æµ‹è¯•ä¸€ä¸‹ runserver å’Œ uWSGI ä¸¤ç§æ–¹å¼å¯åŠ¨é¡¹ç›®çš„æ€§èƒ½å·®è·ï¼Œ<code>ab -n 1000 -c 100 -p data -T application/json http://127.0.0.1:7070/remit_verify/fetch_order/</code>æ„æ€ä¸ºæ€»å…± 1000 æ¬¡è¯·æ±‚ï¼Œå¹¶å‘ 100ï¼Œè®¿é—®åé¢çš„ç™»é™†æ¥å£ã€‚é¦–å…ˆçœ‹ä¸€ä¸‹ä½¿ç”¨ runserver æ–¹å¼è¿è¡Œçš„ Django æˆç»©ï¼š</p><pre tabindex=0><code>    Concurrency Level:      100
    Time taken for tests:   53.702 seconds
    Complete requests:      1000
    Failed requests:        0
    Non-2xx responses:      1000
    Total transferred:      269000 bytes
    Total body sent:        167000
    HTML transferred:       63000 bytes
    Requests per second:    18.62 [#/sec] (mean)
    Time per request:       5370.198 [ms] (mean)
    Time per request:       53.702 [ms] (mean, across all concurrent requests)
    Transfer rate:          4.89 [Kbytes/sec] received
                            3.04 kb/s sent
                            7.93 kb/s total

    Connection Times (ms)
                  min  mean[+/-sd] median   max
    Connect:        0    0   0.6      0       3
    Processing:    18 1574 6329.8    113   53693
    Waiting:        6 1567 6330.6    107   53691
    Total:         18 1575 6330.2    114   53695

    Percentage of the requests served within a certain time (ms)
      50%    114
      66%    133
      75%    147
      80%    177
      90%   1543
      95%   7727
      98%  27565
      99%  53662
     100%  53695 (longest request)
</code></pre><p>ç„¶åå†æ¥çœ‹ä¸€ä¸‹ä½¿ç”¨ uWSGI çš„æˆç»©ï¼š</p><pre tabindex=0><code>    Concurrency Level:      100
    Time taken for tests:   2.223 seconds
    Complete requests:      1000
    Failed requests:        0
    Non-2xx responses:      1000
    Total transferred:      231000 bytes
    Total body sent:        167000
    HTML transferred:       63000 bytes
    Requests per second:    449.93 [#/sec] (mean)
    Time per request:       222.258 [ms] (mean)
    Time per request:       2.223 [ms] (mean, across all concurrent requests)
    Transfer rate:          101.50 [Kbytes/sec] received
                            73.38 kb/s sent
                            174.87 kb/s total

    Connection Times (ms)
                  min  mean[+/-sd] median   max
    Connect:        0    0   0.8      0       4
    Processing:    10  213  30.9    222     298
    Waiting:        6  213  31.0    222     297
    Total:         10  214  30.5    222     300

    Percentage of the requests served within a certain time (ms)
      50%    222
      66%    225
      75%    226
      80%    227
      90%    229
      95%    231
      98%    250
      99%    274
     100%    300 (longest request)
</code></pre><p>å…¶ä¸­ä½¿ç”¨ runserver æ–¹å¼è¿è¡Œå‹åŠ›æµ‹è¯•æ€»å…±è€—æ—¶ 53.7 ç§’ï¼ŒuWSGI è€—æ—¶ 2.2 ç§’ã€‚ä½¿ç”¨ uWSGI åååç‡æ˜¯ 24 å€ï¼Œç”¨æˆ·å¹³å‡ç­‰å¾…æ—¶é—´æ˜¯ 1/24ï¼ŒæœåŠ¡å™¨å¤„ç†æ—¶é•¿ä¹Ÿæ˜¯ 1/24 çš„æ ·å­ã€‚ç»¼åˆæ¥è¯´åœ¨æˆ‘è‡ªå·±é…ç½®æƒ…å†µä¸‹å¾—åˆ°äº†ç­”æ›° 24 å€çš„æ€§èƒ½æå‡ï¼Œæˆ‘è¿™å„¿è¿˜æ˜¯åªæœ‰åŒæ ¸åŒè¿›ç¨‹çš„æƒ…å†µï¼Œå¦‚æœæˆ‘ç»™ docker é…ç½®å…è®¸ä½¿ç”¨æ‰€æœ‰ 12 ä¸ªé€»è¾‘å¤„ç†å™¨ï¼Œæƒ…å†µä¼šæ›´æ˜¾è‘—ã€‚</p><h1 id=0x03-ä¸ºä»€ä¹ˆéœ€è¦-nginx>0X03 ä¸ºä»€ä¹ˆéœ€è¦ Nginx</h1><p>è‡³äºä¸ºä»€ä¹ˆè¦ç”¨ Nginx å°±æ›´ç®€å•äº†ï¼Œæœ‰è¿™ä¹ˆå‡ ä¸ªåŸå› ï¼šé™æ€èµ„æºã€HTTPSã€ç«¯å£ã€å¤šæœåŠ¡éƒ¨ç½²ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p><p>é¦–å…ˆæ˜¯é™æ€èµ„æºï¼Œweb æœåŠ¡æ— å¯é¿å…çš„ä¼šç”¨åˆ°é™æ€èµ„æºï¼Œå°±ç®—å‰åç«¯åˆ†ç¦»å¾—å†å½»åº•ä¹Ÿä¸å…æœ‰ä¸€äº›ä»åç«¯æœåŠ¡ä¸Šè·å–ä¸€äº›é™æ€èµ„æºï¼Œå°¤å…¶æ˜¯ç”¨æˆ·ä¸Šä¼ ä¸‹è½½çš„æ–‡ä»¶ã€‚Python çš„æ€§èƒ½å’±ä»¬ä¹ŸæŠ–åŠ¨ï¼Œå¦‚æœä¸éœ€è¦å¯¹æ–‡ä»¶è¿›è¡Œæƒé™é™åˆ¶çš„è¯ï¼Œçš„ç¡®æ²¡å¿…è¦è®©è¿™äº›è¯·æ±‚å†èµ°ä¸€é Django äº†ã€‚</p><p>ç„¶åæ˜¯ HTTPSï¼Œè¿™ä¸ªä¸œè¥¿å¦‚æœä¸åœ¨ Nginx æˆ–è€… Apache ä¸Šé…ç½®çš„è¯ï¼Œå°±ä¼šå¾ˆéº»çƒ¦ï¼Œæ²¡è¿™ä¸ªå¿…è¦ã€‚</p><p>ç«¯å£é—®é¢˜ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬å¹¶ä¸æ‰“ç®—è®©æœåŠ¡æš´éœ²çš„æ˜¯ 80 æˆ–è€… 443ï¼Œå°¤å…¶æ˜¯å½“æœåŠ¡åœ¨å®¹å™¨ä¸­çš„æ—¶å€™ï¼Œè¿™æ—¶å€™å°±éœ€è¦ç”¨ Nginx æ¥åšä»£ç†è½¬å‘äº†ã€‚</p><p>å¤šæœåŠ¡éƒ¨ç½²å°±æ›´æ˜¯éœ€è¦ Nginx äº†ï¼Œå¦‚æœä½ åªæœ‰ä¸€å°æœåŠ¡å™¨ä½†æ˜¯éœ€è¦éƒ¨ç½²å››äº”ä¸ª web æœåŠ¡æ€ä¹ˆåŠï¼Ÿæ€»ä¸èƒ½è¯´æ¯ä¸ªæœåŠ¡æš´éœ²ä¸åŒçš„ç«¯å£ç„¶åè®©ç”¨æˆ·æ ¹æ®ä¸åŒçš„ç«¯å£æ¥å†³å®šè®¿é—®å“ªä¸ªæœåŠ¡å§ã€‚æ‰€ä»¥è¿˜æ˜¯éœ€è¦ç”¨ Nginx æ¥åšï¼Œæ ¹æ®ä¸åŒçš„åŸŸåæ¥æ§åˆ¶è½¬å‘åˆ°æœ¬åœ°çš„å“ªä¸ªç«¯å£ä¸Šå»ã€‚</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>æ›´æ–°äº 2025-01-17</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/django/>Django</a>,&nbsp;<a href=/tags/uwsgi/>UWSGI</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>è¿”å›</a></span>&nbsp;|&nbsp;<span><a href=/>ä¸»é¡µ</a></span></section></div><div class=post-nav><a href=/posts/django-export-csv/ class=prev rel=prev title="Django ç›¸å¯¹ä¼˜é›…åœ°å¯¼å‡º CSV"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Django ç›¸å¯¹ä¼˜é›…åœ°å¯¼å‡º CSV</a>
<a href=/posts/sso-yu-cas/ class=next rel=next title="SSO ä¸ CAS">SSO ä¸ CAS<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=gitalk class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://github.com/gitalk/gitalk></a>Gitalk</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Shawn ğŸ’— Amber</div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2015 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://blog.programmer.work target=_blank>Shawn</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=å›åˆ°é¡¶éƒ¨><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=æŸ¥çœ‹è¯„è®º><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/gitalk/gitalk.min.7a92033a32beba2a57cd417e2d5ab7ac2a45bf5111227648ac274b81e6a6cf57.css integrity="sha256-epIDOjK+uipXzUF+LVq3rCpFv1ERInZIrCdLgeamz1c="><link rel=stylesheet href=/lib/katex/katex.min.76e39bd605d45b2d1944123c66608b0c8bb9baeb70720b212571531c7cf9bc2a.css integrity="sha256-duOb1gXUWy0ZRBI8ZmCLDIu5uutwcgshJXFTHHz5vCo="><link rel=stylesheet href=/some.4187f1011616875f9033a8af97475eb55b97ed2f80267e22df0cd8305de45cc8.css integrity="sha256-QYfxARYWh1+QM6ivl0detVuX7S+AJn4i3wzYMF3kXMg="><script type=text/javascript src=/lib/gitalk/gitalk.min.3e68fce688cb68f396c11b65309c267b307f420f01cef269e5e4f3bd769801f0.js integrity="sha256-Pmj85ojLaPOWwRtlMJwmezB/Qg8BzvJp5eTzvXaYAfA="></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.3d9120fa621da6d613c1698b7014ec6bdf4620366e8f2b7b547059f4b6f6272b.js integrity="sha256-PZEg+mIdptYTwWmLcBTsa99GIDZujyt7VHBZ9Lb2Jys="></script><script type=text/javascript src=/lib/clipboard/clipboard.min.e17a1d816e13c0826e0ed7febfabc3277f45571234bde0bf9120829a7169edc9.js integrity="sha256-4XodgW4TwIJuDtf+v6vDJ39FVxI0veC/kSCCmnFp7ck="></script><script type=text/javascript src=/lib/katex/katex.min.eb18207487161674e717087c317db14ac1a62dadaecccb802499ce173bfeb739.js integrity="sha256-6xggdIcWFnTnFwh8MX2xSsGmLa2uzMuAJJnOFzv+tzk="></script><script type=text/javascript src=/lib/katex/contrib/auto-render.min.cb7f4ca60ed5dc3e258415f8c7a3b46d4a93578a52adf83011f18a7f190e7602.js integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI="></script><script type=text/javascript src=/lib/katex/contrib/copy-tex.min.52ce78fab4860d24ef22128a52ce24ca01368a9034457a565a1d3fccbab0ddbb.js integrity="sha256-Us54+rSGDSTvIhKKUs4kygE2ipA0RXpWWh0/zLqw3bs="></script><script type=text/javascript src=/lib/katex/contrib/mhchem.min.5c0a121a8b490afc85860a522347aeb34fb508c6b23044e5d29f6b2194227b51.js integrity="sha256-XAoSGotJCvyFhgpSI0eus0+1CMayMETl0p9rIZQie1E="></script><script type=text/javascript>window.config={code:{copyTitle:"å¤åˆ¶åˆ°å‰ªè´´æ¿",maxShownLines:50},comment:{gitalk:{admin:["shawn-bluce"],clientID:"Ov23ligzD7mU8WBsue6H",clientSecret:"a832d1ba967e3a40f5485aa05e2a9e76f2d77901",id:"2020-06-30T13:35:00Z",owner:"shawn-bluce",repo:"shawn-bluce.github.io",title:"ä¸ºä»€ä¹ˆ Django éœ€è¦uWSGI"}},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1}}</script><script type=text/javascript src=/js/theme.min.612a51a43205bbcf3b4af348dc2e8aa60f77f4fe5535ebc57f13054b61607d6c.js integrity="sha256-YSpRpDIFu887SvNI3C6Kpg939P5VNevFfxMFS2FgfWw="></script></body></html>