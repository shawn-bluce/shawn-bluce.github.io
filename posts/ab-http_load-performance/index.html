<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>使用 ab 和 http_load 进行简单的性能测试 - Shawn's blog</title><meta name=Description content="分享我的知识、经验、生活与感悟"><meta property="og:url" content="https://blog.programmer.work/posts/ab-http_load-performance/"><meta property="og:site_name" content="Shawn's blog"><meta property="og:title" content="使用 ab 和 http_load 进行简单的性能测试"><meta property="og:description" content="0X00 概述 我们经常想要简单测试一下某个页面的性能，或者 REST API 的性能，用 postman 这种程序虽然可以很快的模拟请求出来但是并不方便发送大量请求；自己写脚本虽然自定义程度很高，但是写起来总归还是有点麻烦，而且并不能很方便得输出我们需要的一些常用数据。那这种时候一般就需要找些专业的工具来做这种专业的事情了。下面两个就是平时比较常用的性能测试工具，可以针对某个/某些 url 做性能测试，并且输出相对完整的报告。"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-11-04T15:31:00+00:00"><meta property="article:modified_time" content="2025-01-16T07:21:52+00:00"><meta property="article:tag" content="Performance"><meta property="article:tag" content="HTTP"><meta property="article:tag" content="Tools"><meta property="og:image" content="https://blog.programmer.work/logo.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.programmer.work/logo.png"><meta name=twitter:title content="使用 ab 和 http_load 进行简单的性能测试"><meta name=twitter:description content="0X00 概述 我们经常想要简单测试一下某个页面的性能，或者 REST API 的性能，用 postman 这种程序虽然可以很快的模拟请求出来但是并不方便发送大量请求；自己写脚本虽然自定义程度很高，但是写起来总归还是有点麻烦，而且并不能很方便得输出我们需要的一些常用数据。那这种时候一般就需要找些专业的工具来做这种专业的事情了。下面两个就是平时比较常用的性能测试工具，可以针对某个/某些 url 做性能测试，并且输出相对完整的报告。"><meta name=application-name content="Shawn's blog"><meta name=apple-mobile-web-app-title content="Shawn's blog"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://blog.programmer.work/posts/ab-http_load-performance/><link rel=prev href=https://blog.programmer.work/posts/sso-and-ldap/><link rel=next href=https://blog.programmer.work/posts/mysql-query-exec-basic/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"使用 ab 和 http_load 进行简单的性能测试","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.programmer.work\/posts\/ab-http_load-performance\/"},"genre":"posts","keywords":"Performance, HTTP, Tools","wordcount":1434,"url":"https:\/\/blog.programmer.work\/posts\/ab-http_load-performance\/","datePublished":"2020-11-04T15:31:00+00:00","dateModified":"2025-01-16T07:21:52+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Shawn"},"description":""}</script></head><body data-header-desktop=auto data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Shawn's blog">Shawn's blog</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/about/>关于 </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Shawn's blog">Shawn's blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/about/ title>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">使用 ab 和 http_load 进行简单的性能测试</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Shawn</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2020-11-04>2020-11-04</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 1434 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 3 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents></nav></div></div><div class=content id=content><h1 id=0x00-概述>0X00 概述</h1><p>我们经常想要简单测试一下某个页面的性能，或者 REST API 的性能，用 postman 这种程序虽然可以很快的模拟请求出来但是并不方便发送大量请求；自己写脚本虽然自定义程度很高，但是写起来总归还是有点麻烦，而且并不能很方便得输出我们需要的一些常用数据。那这种时候一般就需要找些专业的工具来做这种专业的事情了。下面两个就是平时比较常用的性能测试工具，可以针对某个/某些 url 做性能测试，并且输出相对完整的报告。</p><p>软件具体怎么装就自己想想办法吧，毕竟 Linux/macOS/windows 之间都不太一样，而且 Linux 上还有 apt/dnf/pacman 巴拉巴拉一堆包管理器，用法都不一样，没必要一个个找出来贴上。需要了解 API 性能的人肯定能很轻松装上这些工具了~</p><h1 id=0x01-apache-bench>0X01 apache bench</h1><p>最简单的使用方式：<code>ab -n 20 -c 2 https://example.org/</code>回车，就会执行一次简单的测试并输出报告。这串命令会用<code>GET</code>请求访问<code>https://example.com/</code>，并发为 2，总共发起 20 次请求。<strong>需要注意，测试的时候域名最后已经加上<code>/</code>，因为测试是针对 url 的，而非 domain</strong></p><p>接着我们会得到一个这样的输出结果。其中第一部分是服务器的相关信息；第二部分是本次测试的相关信息；第三部分是连接相关的信息；第四部分是请求耗时的相关信息，我们只是简单看一下请求的响应速度，所以重点看第三和第四部分。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://blog-1251664340.cos.ap-chengdu.myqcloud.com/ab_result.png data-srcset="https://blog-1251664340.cos.ap-chengdu.myqcloud.com/ab_result.png, https://blog-1251664340.cos.ap-chengdu.myqcloud.com/ab_result.png 1.5x, https://blog-1251664340.cos.ap-chengdu.myqcloud.com/ab_result.png 2x" data-sizes=auto alt=https://blog-1251664340.cos.ap-chengdu.myqcloud.com/ab_result.png title=https://blog-1251664340.cos.ap-chengdu.myqcloud.com/ab_result.png></p><p>第三部分内容是连接耗时的数据，分别统计了连接、处理、等待的最小、平均、中位、最大值。</p><p>作为简单的测试结果，第四部分是最值得关注的，工具统计出了所有请求的耗时时间分布。我的这条结果显示 50% 的请求在 592ms 内完成；90% 的请求在 839ms 内完成，100% 的请求在 1069ms 内完成（也就是说最慢的一次请求用了 1069ms）。</p><p>简单的<code>GET</code>请求就到此为止了。如果需要携带 Header（这太常见了，起码登录过后得带个 token 才能真正测试），那就携带新的参数<code>-H </code>即可，类似于这个样子<code>ab -n 10 -c 2 -H 'token: xxxxxxx' https://example.org/</code>。如果需要携带多个 Header 参数，那就多接几个<code>-H</code>也没问题。</p><p>如果要发送 <code>POST</code> 请求，需要先把请求内容写在一个文件里，例如在<code>/homes/shawn/post_data</code>，然后通过<code>-p /home/shawn/post_data</code>就可以把文件内容通过 <code>POST</code> 请求发送出去了，比如这样<code> ab -n 2 -c 1 -p /home/shawn/post_data http://127.0.0.1:2333/</code></p><h1 id=0x02-http_load>0X02 http_load</h1><p><code>http_load</code>可以测试多个 url，不用像 <code>ab</code> 那样只能同时测单一 url；但是问题是不能使用<code>GET</code>以外的其他方法，所以用途也比较单一，用法也比较简单。</p><p>常用 4 个参数：</p><ol><li>-p &ndash;parallel 并发进程数</li><li>-f &ndash;fetches 总访问数</li><li>-r &ndash;rate 每秒访问数</li><li>-s &ndash;seconds 访问总时间</li></ol><p>首先要准备一个纯文本文件，类似这样<code>/home/shawn/urlist</code>的文件</p><pre tabindex=0><code>    https://blog.just666.com/about/
    https://blog.just666.com/about/
    https://blog.just666.com/about/
    https://blog.just666.com/about/
    https://blog.just666.com/about/
    https://blog.just666.com/about/
    https://blog.just666.com/about/
    https://blog.just666.com/about/
    https://blog.just666.com/about/
    https://blog.just666.com/about/
    https://blog.just666.com/about/
    https://blog.just666.com/about/
    https://blog.just666.com/about/
    https://blog.just666.com/about/
    https://blog.just666.com/about/
    https://blog.just666.com/
    https://blog.just666.com/
    https://blog.just666.com/
    https://blog.just666.com/
    https://blog.just666.com/
    https://blog.just666.com/
    https://blog.just666.com/
    https://blog.just666.com/
    https://blog.just666.com/
    https://blog.just666.com/
    https://blog.just666.com/
    https://blog.just666.com/
    https://blog.just666.com/
    https://blog.just666.com/
    https://blog.just666.com/
</code></pre><p>保证每行一个 url，接下来就是<code>http_load -p 3 -f 10 /home/shawn/urllist</code>以 3 的并发量发起 10 次请求，或者<code>http_load -r 5 -s 10 xxx</code> 以每秒 5 次的频率请求 10 秒</p><p>会得到类似这样的输出结果</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://blog-1251664340.cos.ap-chengdu.myqcloud.com/http_load.png data-srcset="https://blog-1251664340.cos.ap-chengdu.myqcloud.com/http_load.png, https://blog-1251664340.cos.ap-chengdu.myqcloud.com/http_load.png 1.5x, https://blog-1251664340.cos.ap-chengdu.myqcloud.com/http_load.png 2x" data-sizes=auto alt=https://blog-1251664340.cos.ap-chengdu.myqcloud.com/http_load.png title=https://blog-1251664340.cos.ap-chengdu.myqcloud.com/http_load.png></p><p>总共发起了 19 次请求；并发为 1；大小是697449 btes；总共用了 10.0025 秒；平均每个连接是36707.8 bytes；平均每次请求 1.89 秒；平均响应是 20ms、最大 125、最小 8.2；</p><p>最后是各个状态码的数量，这里 19 个都是 200，一切正常；如果 50x，尤其是 502/503 这种就有可能是你频繁请求导致服务器不稳定了。</p><p>中间缺了一行<code>msecs/first-response</code>的解释？实话说我也不知道。manual 里没有这个解释，google 没找到官方的解释，二手资料全是复制自同一个人的，结果最初的那个老哥可能也没搞明白就没写。。。</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2025-01-16</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/performance/>Performance</a>,&nbsp;<a href=/tags/http/>HTTP</a>,&nbsp;<a href=/tags/tools/>Tools</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/sso-and-ldap/ class=prev rel=prev title="SSO 和 LDAP"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>SSO 和 LDAP</a>
<a href=/posts/mysql-query-exec-basic/ class=next rel=next title="MySQL 查询执行内幕-基础篇">MySQL 查询执行内幕-基础篇<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=gitalk class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://github.com/gitalk/gitalk></a>Gitalk</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.152.2">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.3.0"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2019 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Shawn</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/gitalk/gitalk.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><script type=text/javascript src=/lib/gitalk/gitalk.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/contrib/auto-render.min.js></script><script type=text/javascript src=/lib/katex/contrib/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{gitalk:{admin:[""],clientID:"",clientSecret:"",id:"2020-11-04T15:31:00Z",owner:"",repo:"",title:"使用 ab 和 http_load 进行简单的性能测试"}},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>