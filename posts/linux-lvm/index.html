<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>LVM 的创建扩容与压缩 - Shawn's blog</title><meta name=Description content="分享我的知识、经验、生活与感悟"><meta property="og:url" content="https://blog.programmer.work/posts/linux-lvm/"><meta property="og:site_name" content="Shawn's blog"><meta property="og:title" content="LVM 的创建扩容与压缩"><meta property="og:description" content="0X00 介绍 阅读并了解 LVM 需要了解：Linux 基本操作、分区概念、文件系统概念
首先 LVM 的全称是 Logical Volume Manager 逻辑卷管理。传统的方式是将一个磁盘分成类似于 sda1/sda2/sda3 的分区，然后再将这些分区格式化成类似于 ext4/xfs 这种文件系统，最后将文件系统挂载到某个目录上。但是这种方式下对磁盘空间进行重分配是比较麻烦的，将新安装的磁盘融入到现有系统中也是比较费力的，这就是 LVM 需要解决的问题。"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-22T13:56:00+00:00"><meta property="article:modified_time" content="2025-03-04T08:51:13+00:00"><meta property="article:tag" content="Linux"><meta property="article:tag" content="LVM"><meta property="og:image" content="https://blog.programmer.work/logo.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.programmer.work/logo.png"><meta name=twitter:title content="LVM 的创建扩容与压缩"><meta name=twitter:description content="0X00 介绍 阅读并了解 LVM 需要了解：Linux 基本操作、分区概念、文件系统概念
首先 LVM 的全称是 Logical Volume Manager 逻辑卷管理。传统的方式是将一个磁盘分成类似于 sda1/sda2/sda3 的分区，然后再将这些分区格式化成类似于 ext4/xfs 这种文件系统，最后将文件系统挂载到某个目录上。但是这种方式下对磁盘空间进行重分配是比较麻烦的，将新安装的磁盘融入到现有系统中也是比较费力的，这就是 LVM 需要解决的问题。"><meta name=application-name content="Shawn's blog"><meta name=apple-mobile-web-app-title content="Shawn's blog"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://blog.programmer.work/posts/linux-lvm/><link rel=prev href=https://blog.programmer.work/posts/security-password/><link rel=next href=https://blog.programmer.work/posts/fucking-tired/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"LVM 的创建扩容与压缩","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.programmer.work\/posts\/linux-lvm\/"},"genre":"posts","keywords":"Linux, LVM","wordcount":1620,"url":"https:\/\/blog.programmer.work\/posts\/linux-lvm\/","datePublished":"2022-09-22T13:56:00+00:00","dateModified":"2025-03-04T08:51:13+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Shawn"},"description":""}</script></head><body data-header-desktop=auto data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"dark"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Shawn's blog">Shawn's blog</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/about/>关于 </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Shawn's blog">Shawn's blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/about/ title>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">LVM 的创建扩容与压缩</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://blog.programmer.work title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Shawn</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2022-09-22>2022-09-22</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 1620 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 4 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#从零创建>从零创建</a></li><li><a href=#扩容>扩容</a></li><li><a href=#压缩>压缩</a></li></ul></nav></div></div><div class=content id=content><h1 id=0x00-介绍>0X00 介绍</h1><blockquote><p>阅读并了解 LVM 需要了解：Linux 基本操作、分区概念、文件系统概念</p></blockquote><p>首先 LVM 的全称是 <em>Logical Volume Manager</em> 逻辑卷管理。传统的方式是将一个磁盘分成类似于 <code>sda1/sda2/sda3</code> 的分区，然后再将这些分区格式化成类似于 <code>ext4/xfs</code> 这种文件系统，最后将文件系统挂载到某个目录上。但是这种方式下对磁盘空间进行重分配是比较麻烦的，将新安装的磁盘融入到现有系统中也是比较费力的，这就是 LVM 需要解决的问题。</p><p>总结下来 LVM 拥有这些功能</p><ol><li>LVM 可以方便的对现有逻辑卷进行压缩（初次分配多的空间不会浪费，可以压缩出来）</li><li>空闲的空间可以随时重新分配给逻辑卷（传统模式只能将空间分给最后一个分区，或者创建新分区）</li><li>新加入的磁盘也可以为其他逻辑卷扩容（传统模式并不方便为某个现有分区扩容）</li><li>可以将两块磁盘融合创建出一个更大的逻辑卷（两块 1T 磁盘可以创建出 2T 的分区）</li></ol><p>特别需要注意的，RAID0 也可以将两个 1T 的磁盘合并为一个 2T 的，并且理论读写速度都会翻倍，但是这和 LVM 完全是两种不同的操作。</p><h1 id=0x01-相关概念>0X01 相关概念</h1><p>开始使用 LVM 前需要先搞清楚它的几个基本概念</p><ul><li>PV 是 Physical Volume 物理卷 — 从磁盘上分出来的物理分区</li><li>VG 是 Volume Group 卷组 — 多个 PV 组成的一个 Group</li><li>LV 是 Logical Volume 逻辑卷 — 从某个 VG 里创建出来的逻辑卷（可以格式化够挂载）</li><li>PE 是 Physical Extent 物理区域 — 是 PV 中最小的存储单元</li><li>LE 是 Logical Extent 逻辑区域 — 是 LV 中做小的存储单元</li></ul><p><img class=lazyload src=/svg/loading.min.svg data-src=https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/15/lvm-cropped.jpg data-srcset="https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/15/lvm-cropped.jpg, https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/15/lvm-cropped.jpg 1.5x, https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/15/lvm-cropped.jpg 2x" data-sizes=auto alt=https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/15/lvm-cropped.jpg title="LVM Cropped"></p><blockquote><p>只是「简单用用」的话可以不管 PE/LE 这两个概念</p></blockquote><h1 id=0x02-测试环境>0X02 测试环境</h1><p>如果你想跟着练习一下的话，这里推荐使用虚拟机，新装一个随便什么 Linux 发行版（还是建议新一点，防止 LVM 版本过老）然后额外分配 2 块 10G 的虚拟磁盘就可以了（截图里是三块，因为我以为做完整个实验需要三块盘，结果最后没用上 😢）。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922m751.png data-srcset="https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922m751.png, https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922m751.png 1.5x, https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922m751.png 2x" data-sizes=auto alt=https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922m751.png title=SCR-20220922-m75></p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922m87.png data-srcset="https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922m87.png, https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922m87.png 1.5x, https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922m87.png 2x" data-sizes=auto alt=https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922m87.png title=SCR-20220922-m87></p><h1 id=0x03-如何使用>0X03 如何使用</h1><p>我们已经知道 PV 就是一个物理分区、VG 是一堆 PV 的集合、LV 是从 VG 中划出来的逻辑卷了，现在开始用起来吧</p><p>其实这里说 PV 是一个物理分区是不严谨的，也可以不分区，直接对整体的块设备进行 <code>pvcreate</code> 的操作，后面为了方便我也会这么操作</p><h2 id=从零创建>从零创建</h2><p>首先我们要通过 LVM 从零创建一个文件系统，就需要一路创建 PV、VG、LV 这三种</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922n99.png data-srcset="https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922n99.png, https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922n99.png 1.5x, https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922n99.png 2x" data-sizes=auto alt=https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922n99.png title=SCR-20220922-n99></p><p>这里可以看到，一共用到了 <code>pvcreate/vgcreate/lvcreate</code> 三个命令，最终创建出来的 lv 就已经是一个块文件了，接下来的格式化与挂载就不再赘述了，而且根据经验也可以猜到如果要删除的话就是 <code>lvremove/vgremove/pvremove</code> 了。</p><p>值得注意的一点是 <code>lvcreate -L 100M -n LV_NAME VG_NAME</code> 这行命令，表示创建一个 100M 的 LV，名字叫做 LV_NAME，从 VG_NAME 这个 VG 创建。</p><p>另一个值得注意的一点是，创建出来的 LV 是一个链接，是为了给 <code>dm-0/dm-1</code> 这种不好记的文件「重命名」，这样一来我们后面格式化、挂载之类的就可以用 <code>LV_NAME</code> 来操作了。</p><h2 id=扩容>扩容</h2><p>上面我们只创建了一个 100M 的分区，其实现在我们来给它扩容。首先我们可以看到 VG 明明有将近 10G 的空间，现在才用了 100M 显然是浪费的，先给这个 LV 扩容到 9G 再说</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922nsd.png data-srcset="https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922nsd.png, https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922nsd.png 1.5x, https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922nsd.png 2x" data-sizes=auto alt=https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922nsd.png title=SCR-20220922-nsd></p><p>上图中可以看到一共执行了这么几个步骤</p><ol><li>检查当前 VG 的状态，看到还剩 9.9G 的空间处于 free 状态</li><li>将 LV 扩容至 9G （扩容命令跟创建差不多，只是没必要指定 VG 了，毕竟 LV 就已经和 VG 绑定了）</li><li>再度检查 VG 的状态，发现空间被划走了</li><li>使用 <code>fdisk -l</code> 看到那个块文件/分区的空间变大了</li></ol><p>那如果这时候空间还不够用呢？这就体现出 LVM 的优势了，我们可以将一块新盘加入到 VG 中，继续给 LV 扩容</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922o2o.png data-srcset="https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922o2o.png, https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922o2o.png 1.5x, https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922o2o.png 2x" data-sizes=auto alt=https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922o2o.png title=SCR-20220922-o2o></p><p>上图中可以看到一共执行了这么几个步骤</p><ol><li>创建一个新的 PV</li><li>将新的 PV 加入 VG</li><li>检查 VG 状态，发现 VG 扩容成功</li><li>将 LV 扩容至 18G</li><li>检查 LV 是否扩容成功</li></ol><h2 id=压缩>压缩</h2><p>接下来就该给 LV 压缩了，例如同一个 VG 下的两个 LV 其中一个空间告急需要从另一个中挪一点空间出来，就可以这么操作（其实跟扩容没有区别）</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922oh2.png data-srcset="https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922oh2.png, https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922oh2.png 1.5x, https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922oh2.png 2x" data-sizes=auto alt=https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922oh2.png title=SCR-20220922-oh2></p><h1 id=0x04-pe-和-le>0X04 PE 和 LE</h1><p>最后解释一下 PE(Physical Extents) 和 LE(Logical Extents) 两个术语。其中 PE 是 PV 的「最小存储单元」，LE 是 LV 的「最小存储单元」。</p><p>需要注意的是 PE 是创建 VG 的时候指定的，而并非创建 PV 的时候。而且 LE 的大小就是 LV 所在的 VG 的 PE 大小（这里有点绕，稍稍停下理解一下）。默认情况下 PE 是 4M，也就是说默认情况下创建出来的 LV 容量都将是 4M 的整数倍，当然也就可以解释下面这种「我明明创建的 99M 为啥变成了 100M」诡异情况了</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922p16.png data-srcset="https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922p16.png, https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922p16.png 1.5x, https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922p16.png 2x" data-sizes=auto alt=https://blog-1251664340.cos.ap-chengdu.myqcloud.com/2022/09/22/scr20220922p16.png title=SCR-20220922-p16></p><p>所以我们从原理上来说，创建 LV 的时候并不是「指定 LV 的容量为多少 M/多少 G」，而是「指定 LV 的容量为多少个 LE」</p><h1 id=0x05-参考资料>0X05 参考资料</h1><p><a href=https://wiki.debian.org/LVM target=_blank rel="noopener noreffer">LVM - Debian Wiki</a>
<a href=https://wiki.archlinux.org/title/LVM target=_blank rel="noopener noreffer">LVM - ArchWiki（有中文）</a></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2025-03-04</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/linux/>Linux</a>,&nbsp;<a href=/tags/lvm/>LVM</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/security-password/ class=prev rel=prev title=如何使数据库中的密码更安全：哈希、加密和加盐><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>如何使数据库中的密码更安全：哈希、加密和加盐</a>
<a href=/posts/fucking-tired/ class=next rel=next title=「累」>「累」<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=gitalk class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://github.com/gitalk/gitalk></a>Gitalk</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.152.2">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.3.0"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2015 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://blog.programmer.work target=_blank>Shawn</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/gitalk/gitalk.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><script type=text/javascript src=/lib/gitalk/gitalk.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/contrib/auto-render.min.js></script><script type=text/javascript src=/lib/katex/contrib/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{gitalk:{admin:["shawn-bluce"],clientID:"Ov23ligzD7mU8WBsue6H",clientSecret:"a832d1ba967e3a40f5485aa05e2a9e76f2d77901",id:"2022-09-22T13:56:00Z",owner:"shawn-bluce",repo:"shawn-bluce.github.io",title:"LVM 的创建扩容与压缩"}},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>